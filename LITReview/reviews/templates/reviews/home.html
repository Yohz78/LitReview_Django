{% extends 'base.html' %}
{% block content %}
    <h1>Bonjour {{request.user}}, voici votre flux</h1>
    <div class="button-nav">
        <button type="button" class="btn btn-light btn-lg"><a href="{% url 'create-ticket' %}">Demander une critique</a></button>
        <button type="button" class="btn btn-light btn-lg" id="create-review"><a href="{% url 'create-reviewticket' %}">Créer une critique</a></button>
    </div>

{% for item in items%}
    {% if item in reviews %}
        {% for review in reviews%}
        <div class="card" style="width: 30rem;">
            <div class="card-body">
                <h5 class="card-title">{{ review.user }} a publié une critique</h5>
                <h6 class="card-subtitle mb-2 text-muted">{{review.headline}} -- {{ review.rating }}*</h6>
                <p class="card-text">{{review.body}}</p>
                <p class="card-text">{{review.ticket.time_created}}</p>
                {% if request.user == review.user %}
                    <a href="{% url 'edit-review' review.id %}" class="card-link">Modifier la critique</a>
                {% endif %}
            </div>
            <div class="card" style="width: 30rem;">
                <div class="card-body">
                    <h5 class="card-title">Ticket -- {{ review.ticket.user }}</h5>
                    <h6 class="card-subtitle mb-2 text-muted">{{ review.ticket.title }}</h6>
                    <p class="card-text">{{ review.ticket.description }}</p>
                    <p class="card-text">{{review.ticket.time_created}}</p>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        {% for ticket in tickets %}
            <div class="card" style="width: 30rem;">
                <div class="card-body">
                    <h5 class="card-title">{{ ticket.user }} a demandé une critique</h5>
                    <h6 class="card-subtitle mb-2 text-muted">{{ ticket.title }}</h6>
                    <p class="card-text">{{ ticket.description }}</p>
                    {% if request.user == ticket.user %}
                        <p><a href="{% url 'edit-ticket' ticket.id %}" class="card-link">Modifier le ticket</a> {{ ticket.time_created}}
                    {% endif %}
                    {% if ticket not in tickets_reviewed %}
                        <a href="{% url 'create-review' ticket.id %}" class="card-link">Créer une critique</a></p>
                    {% else %}
                        <p>Ce ticket a déjà reçu une réponse</p>
                    {% endif %}
                    <p class="card-text">{{review.ticket.time_created}}</p>
                </div>
            </div>
        {% endfor %}
    {% endif %}
{% endfor %}
{% endblock content %}